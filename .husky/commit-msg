#!/bin/bash
RED='\033[0;31m'
GREEN='\033[0;32m'
RESET='\033[0m'

export LANG=en_US.UTF-8
export LC_ALL=en_US.URF-8

COMMIT_MSG_FILE=$1
ORIGINAL_COMMIT_MSG=$(cat $COMMIT_MSG_FILE)
COMMIT_MSG=$ORIGINAL_COMMIT_MSG

# ì»¤ë°‹ë©”ì„¸ì§€ í˜•ì‹ 
# type: summary (ì´ëª¨ì§€ë¥¼ ìžë™ìœ¼ë¡œ ì¶”ê°€)
COMMIT_MESSAGE_REGEX="^[a-z]+: .+"

format_commit_message() {
  # íƒ€ìž…ê³¼ ìš”ì•½ ì¶”ì¶œ
  TYPE=$(echo "$ORIGINAL_COMMIT_MSG" | cut -d ':' -f1 | sed 's/^ *//')
  SUMMARY=$(echo "$ORIGINAL_COMMIT_MSG" | cut -d ':' -f2- | sed 's/^ *//')

  # ì´ëª¨ì§€ ë§µ
  case "$TYPE" in
    feat) EXPECTED_EMOJI="âœ¨";;
    fix|hotfix) EXPECTED_EMOJI="ðŸ›";;
    build) EXPECTED_EMOJI="ðŸ”¨";;
    docs) EXPECTED_EMOJI="ðŸ“";;
    design) EXPECTED_EMOJI="ðŸ’„";;
    merge|Merge) EXPECTED_EMOJI="ðŸ”€";;
    rename) EXPECTED_EMOJI="ðŸšš";;
    style) EXPECTED_EMOJI="ðŸŽ¨";;
    refactor) EXPECTED_EMOJI="â™»ï¸";;
    remove) EXPECTED_EMOJI="ðŸ”¥";;
    test) EXPECTED_EMOJI="âœ…";;
    chore) EXPECTED_EMOJI="ðŸ“¦";;
    *)
      printf "\n${RED}ðŸš« [Commit Blocked] ì»¤ë°‹ ë©”ì‹œì§€ëŠ” 'type: summary' í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤!${RESET}\n"
      printf "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
      printf "ðŸ’¡ ì˜¬ë°”ë¥¸ íƒ€ìž…ì„ ì†Œë¬¸ìžë¡œ ìž…ë ¥í•´ì£¼ì„¸ìš”.\n"
      printf "   â–¶ï¸ feat,fix,hotfix,build,docs,design,merge,rename,style,refactor,remove,test,chore \n\n"
      printf "${GREEN}   (í˜„ìž¬ ì»¤ë°‹ ë©”ì‹œì§€) $COMMIT_MSG \n${RESET}"
      printf "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n"
      exit 1
      ;;
  esac

  # ì´ëª¨ì§€ë¥¼ ìžë™ìœ¼ë¡œ ì»¤ë°‹ ë©”ì‹œì§€ì— ì¶”ê°€
  COMMIT_MSG="$EXPECTED_EMOJI $TYPE: $SUMMARY"
}

validate_commit_message() {
  # í˜•ì‹ ê²€ì¦
  if ! echo "$COMMIT_MSG" | grep -qE "$COMMIT_MESSAGE_REGEX"; then
    printf "\n${RED}ðŸš« [Commit Blocked] ì»¤ë°‹ ë©”ì‹œì§€ëŠ” 'type: summary' í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤!${RESET}\n"
    printf "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
    printf "ðŸ’¡ ì˜¬ë°”ë¥¸ íƒ€ìž…ì„ ì†Œë¬¸ìžë¡œ ìž…ë ¥í•´ì£¼ì„¸ìš”.\n"
    printf "   â–¶ï¸ feat,fix,hotfix,build,docs,design,merge,rename,style,refactor,remove,test,chore \n\n"
    printf "${GREEN}   (í˜„ìž¬ ì»¤ë°‹ ë©”ì‹œì§€) $COMMIT_MSG \n${RESET}"
    printf "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n"
    exit 1
  fi
}

handle_merge_commit() {
  # Merge ì»¤ë°‹ ì²˜ë¦¬
  COMMIT_MSG="ðŸ”€ merge: $ORIGINAL_COMMIT_MSG"
}

# Mergeë¡œ ì‹œìž‘í•˜ëŠ” ì»¤ë°‹ì€ íŠ¹ë³„ ì²˜ë¦¬
if echo "$ORIGINAL_COMMIT_MSG" | grep -q "^Merge"; then
  handle_merge_commit
else
  validate_commit_message
  format_commit_message
fi

echo "$COMMIT_MSG" > $COMMIT_MSG_FILE
echo
echo "ðŸ”† Thanks for keeping the convention ðŸ”†"
echo